<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />

<!-- the main canvas; the only HTML element! -->
<body>
    <div id="drawing"></div>    
</body>

<!-- external packages -->
<script type="text/javascript" src="js/extern/svg.min.js"></script>
<script type="text/javascript" src="js/extern/gl-matrix-min.js"></script>
<script type="text/javascript" src="js/extern/opentype.min.js"></script>
<script type="text/javascript" src="js/extern/svg.foreignobject.js"></script>

<!-- fonts -->
<link rel="stylesheet" href="fonts/geosanslight/stylesheet.css" type="text/css" charset="utf-8" />


<!-- fontawesome -->
<link href="/fonts/fontawesome/css/all.css" rel="stylesheet"> 
<script defer src="/fonts/fontawesome/js/all.js"></script> 


<!-- local imports -->

<script type="text/javascript" src="js/utils/perspective.js"></script>
<script type="text/javascript" src="js/utils/labels.js"></script>
<script type="text/javascript" src="js/config.js"></script>
<script type="text/javascript" src="js/schedule.js"></script>
<script type="text/javascript" src="js/utils.js"></script>
<script type="text/javascript" src="js/icon_map.js"></script>
<script type="text/javascript" src="js/widgets.js"></script>
<script type="text/javascript" src="js/line_plane.js"></script>
<script type="text/javascript" src="js/timeseries.js"></script>

<!-- widgets -->
<script type="text/javascript" src="js/widget_time_weather.js"></script>
<script type="text/javascript" src="js/widget_visibility.js"></script>
<script type="text/javascript" src="js/widget_uv.js"></script>
<script type="text/javascript" src="js/widget_wifi.js"></script>
<script type="text/javascript" src="js/widget_storm_force.js"></script>
<script type="text/javascript" src="js/widget_images.js"></script>
<script type="text/javascript" src="js/widget_time_tide.js"></script>
<script type="text/javascript" src="js/widget_time_labels.js"></script>
<script type="text/javascript" src="js/widget_time_marker.js"></script>
<script type="text/javascript" src="js/widget_events.js"></script>
<script type="text/javascript" src="js/widget_location.js"></script>
<script type="text/javascript" src="js/widget_text_forecast.js"></script>
<script type="text/javascript" src="js/widget_date.js"></script>
<script type="text/javascript" src="js/widget_time.js"></script>
<script type="text/javascript" src="js/widget_rose.js"></script>
<script type="text/javascript" src="js/widget_main_temperature.js"></script>
<script type="text/javascript" src="js/widget_main_forecast_icon.js"></script>
<script type="text/javascript" src="js/widget_moon.js"></script>
<script type="text/javascript" src="js/widget_main_wind.js"></script>
<script type="text/javascript" src="js/widget_signature.js"></script>

Visiblity and UV index widgets
Change the forecast to use the correct index (not index 0), but the latest index closest to midday
Add maps intergration
Add timeseries
Add mini-forecast widget
Styling should be factored out in palettes, sizes, etc.
Update w/o flicker
Arrange items on rose with correct z-order

<script>


// The background and draw context
var draw = SVG('drawing').size(1080, 1920);
var background_rect = draw.rect(1080, 1920).attr({ fill: '#000' })   


// the scheduler call; started after initialising complete
function updateSecond()
{                
    schedule_fetch();
}    

// return the screen bounding box for the given name
function get_skeleton_bbox(name)
{
     var elt = SVG.get(name);
     if(elt)
     {
        return elt.rbox(draw);
     }
     return null; // no such object
}


function init(skeleton_group)
{
    // must be done first, so that widgets know where times are
    init_timeseries(skeleton_group);

    // Initialise all widgets
    for(widget in widgets) 
        {            
            try
            {
                if(widgets[widget].init) 
                {
                    var bbox = get_skeleton_bbox(widget);
                    
                    if(bbox)
                    {                        
                        draw.rect(bbox.w, bbox.h).move(bbox.x,bbox.y).fill('none').stroke('#f0f');
                    }
                    else
                        bbox = {w:0, h:0, x:0, y:0};                
                    widgets[widget].init(bbox);
                
                }
            }
            catch(err)
            {
                console.log(err);
            }

        }

    schedule_fetch(); // initial call to scheduler on start
    var second_timer = setInterval(updateSecond,1000);
}


// Get the skeleton document which has the layout information
raw_request("/assets/prototype_8_skeleton.svg", svg=>{
    var skeleton_group = draw.group();
    skeleton_group.svg(svg);
    skeleton_group.attr({'visibility':'hidden'})
    init(skeleton_group);    
});

     

  

                
      
    
</script>
